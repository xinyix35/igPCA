<!DOCTYPE html>
<html class="writer-html5" lang="Python" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>igPCA.Selection &mdash; igPCA 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=92fd9be5" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=eafc0fe6" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=8eae9801"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../readme.html" class="icon icon-home">
            igPCA
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../readme.html">igPCA</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../readme.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../igPCA.html">igPCA</a></li>
      <li class="breadcrumb-item active">igPCA.Selection</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for igPCA.Selection</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Rank Selection for double-structured Data</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">linalg</span> <span class="k">as</span> <span class="n">LA</span>
<span class="kn">from</span> <span class="nn">.GMD</span> <span class="kn">import</span> <span class="n">GMD</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>


<div class="viewcode-block" id="SelectionMethod">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.SelectionMethod">[docs]</a>
<span class="k">class</span> <span class="nc">SelectionMethod</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This class is the parent of the classes of two rank selection models, that is, </span>
<span class="sd">    GMD regression model and Posterior Mean Model</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    by_insert: boolean, indicating how the class is initialized</span>
<span class="sd">        if True, then all the components are inserted;</span>
<span class="sd">        else, input the following paramters to initialize</span>

<span class="sd">    X : {array-like, sparse matrix} of shape (int n, int p)</span>

<span class="sd">    Sigma : {array-like, sparse matrix} of shape (int n, int n)</span>

<span class="sd">    Phi : {array-like, sparse matrix} of shape (int p, int p)</span>

<span class="sd">    m: int, number of rows of the targeted block;</span>
<span class="sd">        if greater than 0, each blocks are partitioned when initializing</span>
<span class="sd">        otherwise, each block need to be inserted </span>

<span class="sd">    t: int, number of columns of the targeted block;</span>
<span class="sd">        if greater than 0, each blocks are partitioned when initializing</span>
<span class="sd">        otherwise, each block need to be inserted </span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">by_insert</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">Sigma_11</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Sigma_12</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Sigma_21</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Sigma_22</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">Phi_11</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Phi_12</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Phi_21</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Phi_22</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Sigma</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Phi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">by_insert</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init_data_by_input__</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init_sigma_by_input__</span><span class="p">(</span>
                <span class="n">Sigma_11</span><span class="p">,</span> <span class="n">Sigma_12</span><span class="p">,</span> <span class="n">Sigma_21</span><span class="p">,</span> <span class="n">Sigma_22</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init_phi_by_input__</span><span class="p">(</span><span class="n">Phi_11</span><span class="p">,</span> <span class="n">Phi_12</span><span class="p">,</span> <span class="n">Phi_21</span><span class="p">,</span> <span class="n">Phi_22</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Sigma</span> <span class="o">=</span> <span class="n">Sigma</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Phi</span> <span class="o">=</span> <span class="n">Phi</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__partition__</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Sigma_11</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Sigma_12</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Sigma_21</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Sigma_22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__partition__</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Sigma</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Phi_11</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Phi_12</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Phi_21</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Phi_22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__partition__</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Phi</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

<div class="viewcode-block" id="SelectionMethod.__partition__">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.SelectionMethod.__partition__">[docs]</a>
    <span class="k">def</span> <span class="nf">__partition__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">nrow</span><span class="p">,</span> <span class="n">ncol</span><span class="p">):</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">[:</span><span class="n">nrow</span><span class="p">,</span> <span class="p">:</span><span class="n">ncol</span><span class="p">]</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">[:</span><span class="n">nrow</span><span class="p">,</span> <span class="n">ncol</span><span class="p">:]</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">[</span><span class="n">nrow</span><span class="p">:,</span> <span class="p">:</span><span class="n">ncol</span><span class="p">]</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">[</span><span class="n">nrow</span><span class="p">:,</span> <span class="n">ncol</span><span class="p">:]</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">))</span></div>


<div class="viewcode-block" id="SelectionMethod.__init_data_by_input__">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.SelectionMethod.__init_data_by_input__">[docs]</a>
    <span class="k">def</span> <span class="nf">__init_data_by_input__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">=</span> <span class="n">A</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="n">B</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">C</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">D</span> <span class="o">=</span> <span class="n">D</span></div>


<div class="viewcode-block" id="SelectionMethod.__init_sigma_by_input__">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.SelectionMethod.__init_sigma_by_input__">[docs]</a>
    <span class="k">def</span> <span class="nf">__init_sigma_by_input__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Sigma_11</span> <span class="o">=</span> <span class="n">A</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Sigma_12</span> <span class="o">=</span> <span class="n">B</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Sigma_21</span> <span class="o">=</span> <span class="n">C</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Sigma_22</span> <span class="o">=</span> <span class="n">D</span></div>


<div class="viewcode-block" id="SelectionMethod.__init_phi_by_input__">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.SelectionMethod.__init_phi_by_input__">[docs]</a>
    <span class="k">def</span> <span class="nf">__init_phi_by_input__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Phi_11</span> <span class="o">=</span> <span class="n">A</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Phi_12</span> <span class="o">=</span> <span class="n">B</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Phi_21</span> <span class="o">=</span> <span class="n">C</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Phi_22</span> <span class="o">=</span> <span class="n">D</span></div>


<div class="viewcode-block" id="SelectionMethod.__compute_QH_norm__">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.SelectionMethod.__compute_QH_norm__">[docs]</a>
    <span class="k">def</span> <span class="nf">__compute_QH_norm__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">A</span><span class="p">):</span>
        <span class="c1"># compute the Q-H norm of matrix A</span>
        <span class="n">numeric_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>
        <span class="n">numeric_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">A</span><span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">numeric_1</span><span class="p">,</span> <span class="n">numeric_2</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>


<div class="viewcode-block" id="SelectionMethod.__mse_evaluation__">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.SelectionMethod.__mse_evaluation__">[docs]</a>
    <span class="k">def</span> <span class="nf">__mse_evaluation__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">est_A</span><span class="p">):</span>
        <span class="n">m</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">est_A</span><span class="p">)</span>
        <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">-</span> <span class="n">est_A</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__compute_QH_norm__</span><span class="p">(</span>
            <span class="n">LA</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Sigma_11</span><span class="p">),</span> <span class="n">LA</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi_11</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">norm</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>
</div>



<div class="viewcode-block" id="PosteriorMean">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.PosteriorMean">[docs]</a>
<span class="k">class</span> <span class="nc">PosteriorMean</span><span class="p">(</span><span class="n">SelectionMethod</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This class computes the error of a pre-specified partition of data </span>
<span class="sd">    at any rank k, under the Posterior Mean Model</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">by_insert</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">Sigma_11</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Sigma_12</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Sigma_21</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Sigma_22</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">Phi_11</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Phi_12</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Phi_21</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Phi_22</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Sigma</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Phi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">by_insert</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span>
                         <span class="n">Sigma_11</span><span class="p">,</span> <span class="n">Sigma_12</span><span class="p">,</span> <span class="n">Sigma_21</span><span class="p">,</span> <span class="n">Sigma_22</span><span class="p">,</span>
                         <span class="n">Phi_11</span><span class="p">,</span> <span class="n">Phi_12</span><span class="p">,</span> <span class="n">Phi_21</span><span class="p">,</span> <span class="n">Phi_22</span><span class="p">,</span>
                         <span class="n">X</span><span class="p">,</span> <span class="n">Sigma</span><span class="p">,</span> <span class="n">Phi</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>

<div class="viewcode-block" id="PosteriorMean.__fit_once__">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.PosteriorMean.__fit_once__">[docs]</a>
    <span class="k">def</span> <span class="nf">__fit_once__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">GMD</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">X_hat</span></div>


<div class="viewcode-block" id="PosteriorMean.forward_fixed_rank">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.PosteriorMean.forward_fixed_rank">[docs]</a>
    <span class="k">def</span> <span class="nf">forward_fixed_rank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Apply GMD to B, C, D to obtained estmated means, then estimate </span>
<span class="sd">        M_A by self-consistency theorem</span>

<span class="sd">        Paramater</span>
<span class="sd">        ---------</span>
<span class="sd">        k: int, must be greater than 0</span>
<span class="sd">            the specified rank that we computes the error</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Etsimated means of M_A, M_B, M_C, and M_D</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># fit B</span>
        <span class="n">H_B</span> <span class="o">=</span> <span class="n">LA</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Sigma_11</span><span class="p">)</span>
        <span class="n">Q_B</span> <span class="o">=</span> <span class="n">LA</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi_22</span><span class="p">)</span>
        <span class="n">est_B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__fit_once__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">,</span> <span class="n">H_B</span><span class="p">,</span> <span class="n">Q_B</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

        <span class="c1"># fit C</span>
        <span class="n">H_C</span> <span class="o">=</span> <span class="n">LA</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Sigma_22</span><span class="p">)</span>
        <span class="n">Q_C</span> <span class="o">=</span> <span class="n">LA</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi_11</span><span class="p">)</span>
        <span class="n">est_C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__fit_once__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">,</span> <span class="n">H_C</span><span class="p">,</span> <span class="n">Q_C</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

        <span class="c1"># fit D</span>
        <span class="n">est_D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__fit_once__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">,</span> <span class="n">H_C</span><span class="p">,</span> <span class="n">Q_B</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

        <span class="c1"># get the estimated value of M_A</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">est_B</span><span class="p">,</span> <span class="n">LA</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">est_D</span><span class="p">))</span>
        <span class="n">est_A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">est_C</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">est_A</span><span class="p">,</span> <span class="n">est_B</span><span class="p">,</span> <span class="n">est_C</span><span class="p">,</span> <span class="n">est_D</span><span class="p">))</span></div>


    <span class="c1"># compute the conditional mean of A by the estimated means for a fixed rank k</span>
<div class="viewcode-block" id="PosteriorMean.__compute_conditional_mean__">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.PosteriorMean.__compute_conditional_mean__">[docs]</a>
    <span class="k">def</span> <span class="nf">__compute_conditional_mean__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Compute the conditional mean of A by the </span>
<span class="sd">        estimated means for a fixed rank k</span>

<span class="sd">        Paramater</span>
<span class="sd">        ---------</span>
<span class="sd">        k: int, must be greater than 0</span>
<span class="sd">            the specified rank that we computes the error</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Posterior Mean of M_A</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">est_A</span><span class="p">,</span> <span class="n">est_B</span><span class="p">,</span> <span class="n">est_C</span><span class="p">,</span> <span class="n">est_D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward_fixed_rank</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">inv_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Sigma_12</span><span class="p">,</span> <span class="n">LA</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Sigma_22</span><span class="p">))</span>
        <span class="n">inv_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">LA</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi_22</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">Phi_21</span><span class="p">)</span>
        <span class="n">mean_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">inv_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">-</span> <span class="n">est_C</span><span class="p">)</span>
        <span class="n">mean_22</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">inv_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">D</span> <span class="o">-</span> <span class="n">est_D</span><span class="p">)</span>
        <span class="n">mean_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">-</span> <span class="n">est_B</span> <span class="o">-</span> <span class="n">mean_22</span><span class="p">,</span> <span class="n">inv_2</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">est_A</span> <span class="o">+</span> <span class="n">mean_1</span> <span class="o">+</span> <span class="n">mean_2</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="PosteriorMean.error_k">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.PosteriorMean.error_k">[docs]</a>
    <span class="k">def</span> <span class="nf">error_k</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Paramater</span>
<span class="sd">        ---------</span>
<span class="sd">        k: int, must be greater than 0</span>
<span class="sd">            the specified rank that we computes the error</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float: the error of estimation at rank k</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__compute_conditional_mean__</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__mse_evaluation__</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">error</span></div>
</div>



<div class="viewcode-block" id="GMDRegression">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.GMDRegression">[docs]</a>
<span class="k">class</span> <span class="nc">GMDRegression</span><span class="p">(</span><span class="n">SelectionMethod</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This class computes the error of a pre-specified partition of data </span>
<span class="sd">    at any rank k, under the GMD Regression Model</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">by_insert</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">Sigma_11</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Sigma_12</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Sigma_21</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Sigma_22</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">Phi_11</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Phi_12</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Phi_21</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Phi_22</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Sigma</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Phi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">by_insert</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span>
                         <span class="n">Sigma_11</span><span class="p">,</span> <span class="n">Sigma_12</span><span class="p">,</span> <span class="n">Sigma_21</span><span class="p">,</span> <span class="n">Sigma_22</span><span class="p">,</span>
                         <span class="n">Phi_11</span><span class="p">,</span> <span class="n">Phi_12</span><span class="p">,</span> <span class="n">Phi_21</span><span class="p">,</span> <span class="n">Phi_22</span><span class="p">,</span>
                         <span class="n">X</span><span class="p">,</span> <span class="n">Sigma</span><span class="p">,</span> <span class="n">Phi</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<div class="viewcode-block" id="GMDRegression.__regression_fixed_rank__">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.GMDRegression.__regression_fixed_rank__">[docs]</a>
    <span class="k">def</span> <span class="nf">__regression_fixed_rank__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="n">H_D</span> <span class="o">=</span> <span class="n">LA</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Sigma_22</span><span class="p">)</span>
        <span class="n">Q_D</span> <span class="o">=</span> <span class="n">LA</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi_22</span><span class="p">)</span>
        <span class="c1"># fit D</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">GMD</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">,</span> <span class="n">H_D</span><span class="p">,</span> <span class="n">Q_D</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="c1"># compute estimated value of beta</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">Q_D</span> <span class="o">@</span> <span class="n">model</span><span class="o">.</span><span class="n">V</span> <span class="o">@</span>  <span class="n">LA</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">D</span><span class="p">)</span>
                                         <span class="p">)</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">U</span><span class="p">)</span> <span class="o">@</span> <span class="n">H_D</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="GMDRegression.__estimate_A__">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.GMDRegression.__estimate_A__">[docs]</a>
    <span class="k">def</span> <span class="nf">__estimate_A__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
        <span class="n">component_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
        <span class="n">component_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Sigma_12</span><span class="p">,</span> <span class="n">LA</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Sigma_22</span><span class="p">))</span>
        <span class="n">component_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">component_2</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">component_1</span> <span class="o">+</span> <span class="n">component_2</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="GMDRegression.error_k">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.GMDRegression.error_k">[docs]</a>
    <span class="k">def</span> <span class="nf">error_k</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Paramater</span>
<span class="sd">        ---------</span>
<span class="sd">        k: int, must be greater than 0</span>
<span class="sd">            the specified rank that we computes the error</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float: the error of estimation at rank k</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__regression_fixed_rank__</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">est_A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__estimate_A__</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
        <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__mse_evaluation__</span><span class="p">(</span><span class="n">est_A</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">error</span></div>
</div>



<div class="viewcode-block" id="spilt">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.spilt">[docs]</a>
<span class="k">class</span> <span class="nc">spilt</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This class motivates the data spilting process used in Bi-Cross Validation (bcv.py)</span>
<span class="sd">    by the following steps:</span>
<span class="sd">    1. Generating the partitions of rows and column with particular matrix size(n,p) and fold-size(h,l)</span>
<span class="sd">    2. Reorganize the (i,j)-block of matrix to the top left corner</span>
<span class="sd">    3. Generate the corresponding row/column indices for matrices after reorganizing</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n: int, nodefault value, sample size of the original data</span>

<span class="sd">    p: int, no default value, number of covariates of the original data</span>

<span class="sd">    h: int, default = 5, number of partition(fold) in sample</span>

<span class="sd">    l: int, default = 5, number of partition(fold) in covariate</span>

<span class="sd">    Example</span>
<span class="sd">    ----------</span>
<span class="sd">    1. first define a split object, and process the data</span>
<span class="sd">    sp = _spilt(n,p,h,l)</span>
<span class="sd">    sp.forward()</span>
<span class="sd">    2. To obatin the blocks of data X when the (i,j)-block is moved to the top left corner </span>
<span class="sd">    by calling the function split_data() in the class:</span>
<span class="sd">    A, B, C, D = sp.split_data(X, i, j)</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="c1"># size of original data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
        <span class="c1"># numbers of partitons in row and column</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rowpar</span> <span class="o">=</span> <span class="n">h</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colpar</span> <span class="o">=</span> <span class="n">l</span>
        <span class="c1"># initialize row index and column index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">row_index</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">row_size</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">col_index</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">col_size</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="spilt.__row_par_index__">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.spilt.__row_par_index__">[docs]</a>
    <span class="k">def</span> <span class="nf">__row_par_index__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Obatin the size of each partition (in row), and thus obatin</span>
<span class="sd">        the next one index of each partition</span>

<span class="sd">        Example</span>
<span class="sd">        ----------</span>
<span class="sd">        row = [i for i in range(11)]</span>
<span class="sd">        h = 3</span>
<span class="sd">        row_size = [4,4,3]</span>
<span class="sd">        row_index = [0,4,8,11]</span>

<span class="sd">        To obtain the first partition, we have row[0:4] = [0,1,2,3]</span>
<span class="sd">        To obatin the second partition, we have row[4:8] = [4,5,6,7]</span>
<span class="sd">        To obatin the third partition, we have row[8:11] = [8,9,10]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">m</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divmod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowpar</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">row_size</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">r</span> <span class="o">+</span> <span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rowpar</span> <span class="o">-</span> <span class="n">r</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">row_index</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_size</span><span class="p">[:</span><span class="n">i</span><span class="p">])</span>
                          <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rowpar</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span></div>


<div class="viewcode-block" id="spilt.__col_par_index__">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.spilt.__col_par_index__">[docs]</a>
    <span class="k">def</span> <span class="nf">__col_par_index__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        generate the size of each partition (in column), and thus obatin</span>
<span class="sd">        the first index of each partition</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">m</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divmod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colpar</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">col_size</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">r</span> <span class="o">+</span> <span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colpar</span> <span class="o">-</span> <span class="n">r</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">col_index</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col_size</span><span class="p">[:</span><span class="n">i</span><span class="p">])</span>
                          <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colpar</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span></div>


<div class="viewcode-block" id="spilt.forward">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.spilt.forward">[docs]</a>
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__row_par_index__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__col_par_index__</span><span class="p">()</span></div>


<div class="viewcode-block" id="spilt.__A_index__">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.spilt.__A_index__">[docs]</a>
    <span class="k">def</span> <span class="nf">__A_index__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Paramater</span>
<span class="sd">        ---------</span>
<span class="sd">        i: int, index of row partition, starts from 0</span>
<span class="sd">        j: int, index of row partition, starts from 0</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        the row indices and column indices of the (i,j)-block of data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">full_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)]</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">full_row</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">row_index</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">row_index</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span>
        <span class="n">full_col</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)]</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">full_col</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">col_index</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_index</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">))</span></div>


<div class="viewcode-block" id="spilt.__B_index__">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.spilt.__B_index__">[docs]</a>
    <span class="k">def</span> <span class="nf">__B_index__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Paramater</span>
<span class="sd">        ---------</span>
<span class="sd">        i: int, index of row partition, starts from 0</span>
<span class="sd">        j: int, index of row partition, starts from 0</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        the row indices and column indices of the (i,\j)-block of data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">full_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)]</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">full_row</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">row_index</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">row_index</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col_index</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col_size</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_index</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
                <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col_size</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
                <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col_index</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">))</span></div>


<div class="viewcode-block" id="spilt.__C_index__">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.spilt.__C_index__">[docs]</a>
    <span class="k">def</span> <span class="nf">__C_index__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Paramater</span>
<span class="sd">        ---------</span>
<span class="sd">        i: int, index of row partition, starts from 0</span>
<span class="sd">        j: int, index of row partition, starts from 0</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        the row indices and column indices of the (\i,j)-block of data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_index</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_size</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">row_index</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_size</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_index</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="n">full_col</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)]</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">full_col</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">col_index</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_index</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">))</span></div>


<div class="viewcode-block" id="spilt.__D_index__">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.spilt.__D_index__">[docs]</a>
    <span class="k">def</span> <span class="nf">__D_index__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Paramater</span>
<span class="sd">        ---------</span>
<span class="sd">        i: int, index of row partition, starts from 0</span>
<span class="sd">        j: int, index of row partition, starts from 0</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        the row indices and column indices of the (\i,\j)-block of data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_index</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_size</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">row_index</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_size</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_index</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col_index</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col_size</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_index</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
                <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col_size</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
                <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col_index</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">))</span></div>


<div class="viewcode-block" id="spilt.__sigma_11_index__">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.spilt.__sigma_11_index__">[docs]</a>
    <span class="k">def</span> <span class="nf">__sigma_11_index__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Paramater</span>
<span class="sd">        ---------</span>
<span class="sd">        i: int, index of row partition, starts from 0</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        the index list of the row covariance matrix for (i,*)-block</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># full_row = [t for t in range(self.n)]</span>
        <span class="c1"># row = full_row[self.row_index[i]: self.row_index[i + 1]]</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_index</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">row_index</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span></div>


<div class="viewcode-block" id="spilt.__sigma_22_index__">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.spilt.__sigma_22_index__">[docs]</a>
    <span class="k">def</span> <span class="nf">__sigma_22_index__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Paramater</span>
<span class="sd">        ---------</span>
<span class="sd">        i: int, index of row partition, starts from 0</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        the index list of the row covariance matrix for (\i,*)-block</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_index</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_size</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">row_index</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_size</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_index</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="spilt.__sigma_12_index__">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.spilt.__sigma_12_index__">[docs]</a>
    <span class="k">def</span> <span class="nf">__sigma_12_index__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Paramater</span>
<span class="sd">        ---------</span>
<span class="sd">        i: int, index of row partition, starts from 0</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tthe row indices and column indices for the row covariance matrix between</span>
<span class="sd">        (i,*)-block and (\i,*)-block</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_index</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">row_index</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_index</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_size</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">row_index</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_size</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_index</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span></div>


<div class="viewcode-block" id="spilt.__sigma_21_index__">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.spilt.__sigma_21_index__">[docs]</a>
    <span class="k">def</span> <span class="nf">__sigma_21_index__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Paramater</span>
<span class="sd">        ---------</span>
<span class="sd">        i: int, index of row partition, starts from 0</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tthe row indices and column indices for the row covariance matrix between</span>
<span class="sd">        (\i,*)-block and (i,*)-block</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sigma_12_index__</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span></div>


<div class="viewcode-block" id="spilt.__phi_11_index__">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.spilt.__phi_11_index__">[docs]</a>
    <span class="k">def</span> <span class="nf">__phi_11_index__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Paramater</span>
<span class="sd">        ---------</span>
<span class="sd">        j: int, index of column partition, starts from 0</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        the index list of the row covariance matrix for (*,j)-block</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col_index</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_index</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span></div>


<div class="viewcode-block" id="spilt.__phi_22_index__">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.spilt.__phi_22_index__">[docs]</a>
    <span class="k">def</span> <span class="nf">__phi_22_index__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Paramater</span>
<span class="sd">        ---------</span>
<span class="sd">        j: int, index of column partition, starts from 0</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        the index list of the row covariance matrix for (*,\j)-block</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col_index</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col_size</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_index</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
                <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col_size</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
                <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col_index</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">))</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="spilt.__phi_12_index__">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.spilt.__phi_12_index__">[docs]</a>
    <span class="k">def</span> <span class="nf">__phi_12_index__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Paramater</span>
<span class="sd">        ---------</span>
<span class="sd">        i: int, index of row partition, starts from 0</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tthe row indices and column indices for the column covariance matrix between</span>
<span class="sd">        (*,j)-block and (*,\j)-block</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col_index</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_index</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col_index</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col_size</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_index</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
                <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col_size</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
                <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col_index</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span></div>


<div class="viewcode-block" id="spilt.__phi_21_index__">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.spilt.__phi_21_index__">[docs]</a>
    <span class="k">def</span> <span class="nf">__phi_21_index__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Paramater</span>
<span class="sd">        ---------</span>
<span class="sd">        i: int, index of row partition, starts from 0</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tthe row indices and column indices for the column covariance matrix between</span>
<span class="sd">        (*,\j)-block and (*,j)-block</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__phi_12_index__</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span></div>


<div class="viewcode-block" id="spilt.split_data">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.spilt.split_data">[docs]</a>
    <span class="k">def</span> <span class="nf">split_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Paramater</span>
<span class="sd">        ---------</span>
<span class="sd">        X : {array-like, sparse matrix} of shape (int n, int p)</span>

<span class="sd">        i: int, index of row partition, starts from 0</span>

<span class="sd">        j: int, index of column partition, starts from 0</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List of the four new blocks when (i,j)-block being the targeted partition</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># New A, New B, New C, New D</span>
        <span class="n">r</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__A_index__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">r</span><span class="p">][:,</span> <span class="n">c</span><span class="p">]</span>
        <span class="n">r</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__B_index__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">r</span><span class="p">][:,</span> <span class="n">c</span><span class="p">]</span>
        <span class="n">r</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__C_index__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">r</span><span class="p">][:,</span> <span class="n">c</span><span class="p">]</span>
        <span class="n">r</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__D_index__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">r</span><span class="p">][:,</span> <span class="n">c</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">))</span></div>


<div class="viewcode-block" id="spilt.split_sigma">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.spilt.split_sigma">[docs]</a>
    <span class="k">def</span> <span class="nf">split_sigma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Sigma</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Paramater</span>
<span class="sd">        ---------</span>
<span class="sd">        Sigma : {array-like, sparse matrix} of shape (int n, int n)</span>

<span class="sd">        i: int, index of row partition, starts from 0</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List of the four row covariance matrices when (i,j)-block being the targeted partition</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sigma_11_index__</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">Sigma_11</span> <span class="o">=</span> <span class="n">Sigma</span><span class="p">[</span><span class="n">r</span><span class="p">][:,</span> <span class="n">r</span><span class="p">]</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sigma_22_index__</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">Sigma_22</span> <span class="o">=</span> <span class="n">Sigma</span><span class="p">[</span><span class="n">c</span><span class="p">][:,</span> <span class="n">c</span><span class="p">]</span>
        <span class="n">Sigma_12</span> <span class="o">=</span> <span class="n">Sigma</span><span class="p">[</span><span class="n">r</span><span class="p">][:,</span> <span class="n">c</span><span class="p">]</span>
        <span class="n">Sigma_21</span> <span class="o">=</span> <span class="n">Sigma</span><span class="p">[</span><span class="n">c</span><span class="p">][:,</span> <span class="n">r</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">Sigma_11</span><span class="p">,</span> <span class="n">Sigma_12</span><span class="p">,</span> <span class="n">Sigma_21</span><span class="p">,</span> <span class="n">Sigma_22</span><span class="p">))</span></div>


<div class="viewcode-block" id="spilt.split_phi">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.spilt.split_phi">[docs]</a>
    <span class="k">def</span> <span class="nf">split_phi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Phi</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Paramater</span>
<span class="sd">        ---------</span>
<span class="sd">        Phi : {array-like, sparse matrix} of shape (int p, int p)</span>

<span class="sd">        j: int, index of column partition, starts from 0</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List of the four column covariance matrices when (i,j)-block being the targeted partition</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__phi_11_index__</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="n">Phi_11</span> <span class="o">=</span> <span class="n">Phi</span><span class="p">[</span><span class="n">r</span><span class="p">][:,</span> <span class="n">r</span><span class="p">]</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__phi_22_index__</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="n">Phi_22</span> <span class="o">=</span> <span class="n">Phi</span><span class="p">[</span><span class="n">c</span><span class="p">][:,</span> <span class="n">c</span><span class="p">]</span>
        <span class="n">Phi_12</span> <span class="o">=</span> <span class="n">Phi</span><span class="p">[</span><span class="n">r</span><span class="p">][:,</span> <span class="n">c</span><span class="p">]</span>
        <span class="n">Phi_21</span> <span class="o">=</span> <span class="n">Phi</span><span class="p">[</span><span class="n">c</span><span class="p">][:,</span> <span class="n">r</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">Phi_11</span><span class="p">,</span> <span class="n">Phi_12</span><span class="p">,</span> <span class="n">Phi_21</span><span class="p">,</span> <span class="n">Phi_22</span><span class="p">))</span></div>
</div>



<div class="viewcode-block" id="BiCrossValidation">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.BiCrossValidation">[docs]</a>
<span class="k">class</span> <span class="nc">BiCrossValidation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    BCV is the class to carry out the bi-cross validation process</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    X : {array-like, sparse matrix} of shape (int n, int p)</span>

<span class="sd">    Sigma : {array-like, sparse matrix} of shape (int n, int n)</span>

<span class="sd">    Phi : {array-like, sparse matrix} of shape (int p, int p)</span>

<span class="sd">    h: int, default = 5, number of partition(fold) in sample</span>

<span class="sd">    l: int, default = 5, number of partition(fold) in covariate</span>

<span class="sd">    K: {list(int), int}, candidiates for the rank of tiplet (X, H, Q)</span>
<span class="sd">        If K is an integer, the candidates will be [1, 2, ....K]</span>

<span class="sd">    method: str in {&#39;pst&#39;, &#39;reg&#39;}, default = &#39;pst&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Sigma</span><span class="p">,</span> <span class="n">Phi</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pst&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Sigma</span> <span class="o">=</span> <span class="n">Sigma</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Phi</span> <span class="o">=</span> <span class="n">Phi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">h</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l</span> <span class="o">=</span> <span class="n">l</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">h</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">K</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">K</span><span class="p">))</span>
        <span class="c1"># initialize spilt class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sp</span> <span class="o">=</span> <span class="n">spilt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sp</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span>
        <span class="c1"># initialize method, default method is posterior mean method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span>
        <span class="c1"># initialize the rank selection result</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rank_min</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rank_one_std</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="n">K</span>
        <span class="c1"># initialize standard error for each rank</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">std_each_rank</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">)</span>

<div class="viewcode-block" id="BiCrossValidation._init_model_">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.BiCrossValidation._init_model_">[docs]</a>
    <span class="k">def</span> <span class="nf">_init_model_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp</span><span class="o">.</span><span class="n">split_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="n">sigma_11</span><span class="p">,</span> <span class="n">sigma_12</span><span class="p">,</span> <span class="n">sigma_21</span><span class="p">,</span> <span class="n">sigma_22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp</span><span class="o">.</span><span class="n">split_sigma</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Sigma</span><span class="p">,</span> <span class="n">i</span>
        <span class="p">)</span>
        <span class="c1"># sigma_11, sigma_12, sigma_21, sigma_22 = self.sp.split_sigma(</span>
        <span class="c1">#     self.Sigma, j</span>
        <span class="c1"># )</span>
        <span class="n">phi_11</span><span class="p">,</span> <span class="n">phi_12</span><span class="p">,</span> <span class="n">phi_21</span><span class="p">,</span> <span class="n">phi_22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp</span><span class="o">.</span><span class="n">split_phi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;pst&quot;</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">PosteriorMean</span><span class="p">(</span><span class="n">by_insert</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="n">D</span><span class="p">,</span>
                                  <span class="n">Sigma_11</span><span class="o">=</span><span class="n">sigma_11</span><span class="p">,</span> <span class="n">Sigma_12</span><span class="o">=</span><span class="n">sigma_12</span><span class="p">,</span> <span class="n">Sigma_21</span><span class="o">=</span><span class="n">sigma_21</span><span class="p">,</span> <span class="n">Sigma_22</span><span class="o">=</span><span class="n">sigma_22</span><span class="p">,</span>
                                  <span class="n">Phi_11</span><span class="o">=</span><span class="n">phi_11</span><span class="p">,</span> <span class="n">Phi_12</span><span class="o">=</span><span class="n">phi_12</span><span class="p">,</span> <span class="n">Phi_21</span><span class="o">=</span><span class="n">phi_21</span><span class="p">,</span> <span class="n">Phi_22</span><span class="o">=</span><span class="n">phi_22</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;reg&quot;</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">GMDRegression</span><span class="p">(</span><span class="n">by_insert</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="n">D</span><span class="p">,</span>
                                  <span class="n">Sigma_11</span><span class="o">=</span><span class="n">sigma_11</span><span class="p">,</span> <span class="n">Sigma_12</span><span class="o">=</span><span class="n">sigma_12</span><span class="p">,</span> <span class="n">Sigma_21</span><span class="o">=</span><span class="n">sigma_21</span><span class="p">,</span> <span class="n">Sigma_22</span><span class="o">=</span><span class="n">sigma_22</span><span class="p">,</span>
                                  <span class="n">Phi_11</span><span class="o">=</span><span class="n">phi_11</span><span class="p">,</span> <span class="n">Phi_12</span><span class="o">=</span><span class="n">phi_12</span><span class="p">,</span> <span class="n">Phi_21</span><span class="o">=</span><span class="n">phi_21</span><span class="p">,</span> <span class="n">Phi_22</span><span class="o">=</span><span class="n">phi_22</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Wrong Method Input&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span></div>


<div class="viewcode-block" id="BiCrossValidation.fit">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.BiCrossValidation.fit">[docs]</a>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit the Rank Selection model with different rank for all the h*l folds,</span>
<span class="sd">        and store the result in an array self.error_mean:</span>
<span class="sd">            store mean error for every fold, with $K$ different values corresponding </span>
<span class="sd">            to different ranks in K(list)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="p">):</span>
                <span class="n">select_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_model_</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;fit the models with different rank&quot;&quot;&quot;</span>
                <span class="n">error</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">:</span>
                    <span class="n">error</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">select_model</span><span class="o">.</span><span class="n">error_k</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">block_error</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">error</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_error</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error_mean</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="BiCrossValidation.rank_selection">
<a class="viewcode-back" href="../../autoapi/igPCA/Selection/index.html#igPCA.Selection.BiCrossValidation.rank_selection">[docs]</a>
    <span class="k">def</span> <span class="nf">rank_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fig_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns</span>
<span class="sd">        --------</span>
<span class="sd">        ranks by both minimum error as well as one-stanard error rule</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">col_name</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_error</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                          <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="n">col_name</span><span class="p">)</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;one-std rule&quot;&quot;&quot;</span>
        <span class="n">min_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error_mean</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rank_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">[</span><span class="n">min_index</span><span class="p">]</span>
        <span class="n">std_k</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
        <span class="n">std_k</span> <span class="o">=</span> <span class="n">std_k</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="p">)</span>
        <span class="n">min_val_std</span> <span class="o">=</span> <span class="n">std_k</span><span class="p">[</span><span class="n">min_index</span><span class="p">]</span>
        <span class="n">min_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error_mean</span><span class="p">)</span>
        <span class="n">range_error_id</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">index</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">))</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error_mean</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min_error</span> <span class="o">-</span> <span class="n">min_val_std</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_mean</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">min_error</span> <span class="o">+</span> <span class="n">min_val_std</span>
            <span class="p">)</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rank_one_std</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">range_error_id</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">error_mean</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">std_k</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig_name</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">rank_one_std</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank_min</span><span class="p">))</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Xinyi Xie.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>